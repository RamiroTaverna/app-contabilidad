{% extends "base.html" %}
{% block content %}
<section>
  <div class="title">
    <h2>Estado de Situaci√≥n Patrimonial</h2>
    <div class="actions">
      <button id="btn-actualizar" class="btn">Actualizar</button>
    </div>
  </div>
  <div style="max-height:420px; overflow:auto">
    <table id="tabla-esp">
      <thead>
        <tr>
          <th>Cod Rubro</th>
          <th>Rubro</th>
          <th>Cod Subrubro</th>
          <th>Subrubro</th>
          <th style="text-align:right">Importe</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</section>
<script>
(async function(){
  async function actualizar(){
    const r = await fetch(`/accounting/api/estado-patrimonial`);
    if (!r.ok) {
      console.error('Error al cargar estado patrimonial');
      return;
    }
    const data = await r.json();
    const rows = data.rows || [];
    const tbody = document.querySelector('#tabla-esp tbody');
    tbody.innerHTML = '';
    
    for (const r of rows){
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${r.cod_rubro || ''}</td>
        <td>${r.rubro || ''}</td>
        <td>${r.cod_subrubro || ''}</td>
        <td>${r.subrubro || ''}</td>
        <td style="text-align:right">${r.importe.toFixed(2)}</td>`;
      tbody.appendChild(tr);
    }
  }
  document.getElementById('btn-actualizar').addEventListener('click', actualizar);
  actualizar();
})();
</script>
{% endblock %}
