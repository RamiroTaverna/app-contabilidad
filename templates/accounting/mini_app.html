{% extends "base.html" %}
{% block title %}Mini Contable{% endblock %}
{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='accounting/mini.css') }}">
<div class="msc-body" data-empresa="{{ empresa_sel or '' }}">
  <header class="msc-header">
    <div class="msc-wrap">
      <h1 class="msc-title">Mini Sistema Contable</h1>
      <div class="msc-sub">Libro Diario</div>
      <nav id="tabs"></nav>
      {% if empresas is not none %}
      <form method="get" action="{{ url_for('accounting.mini') }}" style="margin-top:10px; display:flex; gap:8px; align-items:center; flex-wrap:wrap">
        <label style="font-size:12px; color:var(--muted)">Empresa
          <select name="empresa" style="margin-left:6px; min-width:220px">
            <option value="">— Elegir —</option>
            {% for e in empresas %}
              <option value="{{ e.id_empresa }}" {% if empresa_sel == e.id_empresa %}selected{% endif %}>{{ e.nombre }}</option>
            {% endfor %}
          </select>
        </label>
        <button class="btn">Ver</button>
      </form>
      {% endif %}
    </div>
  </header>

  <main class="msc-main">
    <!-- Sección de Estado de Resultados -->
    <section id="sec-estado-resultados" class="hidden">
      <div class="title">
        <h2>Estado de Resultados</h2>
        <div class="actions">
          <div class="date-range">
            <label>Desde: <input type="date" id="erFechaDesde" class="date-input"></label>
            <label>Hasta: <input type="date" id="erFechaHasta" class="date-input"></label>
            <button class="btn" id="btnGenerarER">Generar Reporte</button>
            <button class="btn" id="btnExportarPDF">Exportar PDF</button>
            <button class="btn" id="btnExportarExcel">Exportar Excel</button>
          </div>
        </div>
      </div>
      <div class="report-container">
        <div id="erHeader" class="report-header">
          <h3>Estado de Resultados</h3>
          <div id="erPeriodo" class="periodo">Período: </div>
        </div>
        
        <div class="report-section">
          <h4>Ingresos</h4>
          <table id="tablaIngresos" class="report-table">
            <thead>
              <tr>
                <th>Cuenta</th>
                <th class="amount">Importe</th>
              </tr>
            </thead>
            <tbody></tbody>
            <tfoot>
              <tr class="total">
                <td>Total Ingresos</td>
                <td id="totalIngresos" class="amount">0.00</td>
              </tr>
            </tfoot>
          </table>
        </div>
        
        <div class="report-section">
          <h4>Gastos</h4>
          <table id="tablaGastos" class="report-table">
            <thead>
              <tr>
                <th>Cuenta</th>
                <th class="amount">Importe</th>
              </tr>
            </thead>
            <tbody></tbody>
            <tfoot>
              <tr class="total">
                <td>Total Gastos</td>
                <td id="totalGastos" class="amount">0.00</td>
              </tr>
            </tfoot>
          </table>
        </div>
        
        <div class="report-section resultado">
          <h4>Resultado del Ejercicio</h4>
          <div id="resultadoEjercicio" class="resultado-total">0.00</div>
          <div id="resultadoTipo" class="resultado-tipo">(Utilidad)</div>
        </div>
      </div>
    </section>
    
    <section id="sec-cuentas">
      <div class="title">
        <h2>Plan de Cuentas</h2>
        <div class="actions">
          <button class="btn ghost" id="seedBtn">Cargar ejemplo</button>
          <button class="btn" id="exportBtn">Exportar JSON</button>
          <input type="file" id="importFile" class="hidden" accept="application/json" />
          <button class="btn" id="importBtn">Importar JSON</button>
          <button class="btn danger" id="resetBtn">Borrar todo</button>
        </div>
      </div>
      <div class="grid two" style="padding:14px 16px">
        <div>
          <label>Código</label>
          <input id="accCode" placeholder="1101" />
        </div>
        <div>
          <label>Nombre</label>
          <input id="accName" placeholder="Caja" />
        </div>
        <div>
          <label>Rubro</label>
          <select id="accRubro">
            <option>Activo</option>
            <option>Pasivo</option>
            <option>Patrimonio Neto</option>
            <option>Cuentas de Resultado</option>
          </select>
        </div>
        <div>
          <label>Subrubro</label>
          <select id="accSubName"></select>
        </div>
        <div>
          <label>Cód. Subrubro</label>
          <input id="accSubCode" placeholder="1101.01" />
        </div>
        <div style="align-self:end">
          <button class="btn primary" id="addAcc">Agregar cuenta</button>
        </div>
      </div>
      <div style="padding:0 0 12px 0;max-height:260px;overflow:auto">
        <table id="tablaCuentas">
          <thead>
            <tr><th style="width:120px">Código</th><th>Nombre</th><th style="width:140px">Tipo</th><th style="width:180px">Subrubro</th><th style="width:90px">Acciones</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <section id="sec-diario">
      <div class="title">
        <h2>Libro Diario (Asientos)</h2>
        <div class="actions">
          <span class="pill monospace" id="infoDescuadre">=</span>
        </div>
      </div>
      <div class="grid three" style="padding:14px 16px">
        <div>
          <label>Fecha</label>
          <input type="date" id="jeDate" />
        </div>
        <div>
          <label>Concepto</label>
          <input id="jeConcepto" placeholder="Venta contado / Pago proveedores / etc." />
        </div>
        <div style="align-self:end">
          <button class="btn primary" id="addLinea">Añadir línea</button>
          <button class="btn accent" id="addAsiento">Guardar asiento</button>
        </div>
      </div>
      <div style="padding:0 0 12px 0">
        <table id="tablaEntrada">
          <thead>
            <tr>
              <th style="width:250px">Cuenta</th>
              <th style="width:130px">Debe</th>
              <th style="width:130px">Haber</th>
              <th style="width:90px">Acción</th>
            </tr>
          </thead>
          <tbody></tbody>
          <tfoot>
            <tr>
              <td>Total</td>
              <td class="monospace" id="totDebe">0.00</td>
              <td class="monospace" id="totHaber">0.00</td>
              <td></td>
            </tr>
          </tfoot>
        </table>
      </div>
      <div style="max-height:260px;overflow:auto">
        <table id="tablaDiario">
          <thead>
            <tr>
              <th style="width:110px">Fecha</th>
              <th>Concepto</th>
              <th style="width:120px">Debe</th>
              <th style="width:120px">Haber</th>
              <th style="width:110px">Acción</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    
  </main>
</div>
<script type="module" src="{{ url_for('static', filename='accounting/api.js') }}"></script>
<script src="{{ url_for('static', filename='accounting/mini.js') }}"></script>
{% endblock %}
